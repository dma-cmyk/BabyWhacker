<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ¤ã¡ã‚ƒã‚“ãƒ¢ã‚°ãƒ©ãŸãŸãã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Mochiy+Pop+One', sans-serif;
            touch-action: manipulation;
            overflow: hidden;
        }
        .hole {
            background-color: #689f38;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            box-shadow: inset 0 6px 10px rgba(0,0,0,0.3);
        }
        .character {
            font-size: 4vw;
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translate(-50%, 100%);
            transition: transform 0.2s ease-out;
            pointer-events: none;
        }
        .hole.up .character {
            transform: translate(-50%, 10%);
        }
        .whacked {
            animation: whacked 0.3s ease-in-out;
        }
        @keyframes whacked {
            0% { transform: translate(-50%, 10%) scale(1); }
            50% { transform: translate(-50%, 10%) scale(1.2) rotate(-15deg); }
            100% { transform: translate(-50%, 100%) scale(1); }
        }
        #speech-bubble {
            position: absolute;
            background-color: white;
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transform: translate(-50%, -120%);
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            white-space: nowrap;
            pointer-events: none;
            z-index: 10;
        }
        #speech-bubble.show {
            opacity: 1;
            transform: translate(-50%, -140%);
        }
        #speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 8px 8px 0;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }
    </style>
</head>
<body class="bg-green-100 text-green-800 flex flex-col items-center justify-center min-h-screen p-4">

    <div id="start-screen" class="text-center p-8 bg-white/80 rounded-2xl shadow-lg">
        <h1 class="text-4xl md:text-5xl font-bold mb-4 text-green-600">èµ¤ã¡ã‚ƒã‚“ãƒ¢ã‚°ãƒ©ãŸãŸã</h1>
        <p class="text-lg mb-8">èµ¤ã¡ã‚ƒã‚“(ğŸ‘¶)ã‚’å©ã„ã¦ã‚¹ã‚³ã‚¢UPï¼<br>ãƒ„ã‚¤ãƒ•ã‚§ãƒŸ(ğŸ‘©â€ğŸ«)ã‚’å©ãã¨æ¸›ç‚¹ã ã‚ˆï¼</p>
        <button id="start-button" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-4 px-8 rounded-full text-2xl shadow-md transform hover:scale-105 transition-transform duration-300">
            ã‚²ãƒ¼ãƒ é–‹å§‹ï¼
        </button>
    </div>

    <div id="game-screen" class="hidden w-full max-w-4xl mx-auto text-center">
        <div class="bg-white/80 p-4 rounded-2xl shadow-lg mb-4 flex justify-around items-center flex-wrap gap-4">
            <div>
                <span class="text-lg">ã‚¹ã‚³ã‚¢</span>
                <span id="score" class="text-3xl font-bold">0</span>
            </div>
            <div>
                <span class="text-lg">ã®ã“ã‚Šæ™‚é–“</span>
                <span id="timer" class="text-3xl font-bold">30</span>
            </div>
            <button id="mute-button" class="bg-pink-400 hover:bg-pink-500 text-white font-bold py-2 px-4 rounded-full text-lg shadow-md transform hover:scale-105 transition-transform duration-300">SOUNDğŸ”Š</button>
        </div>

        <div id="game-board" class="grid grid-cols-3 sm:grid-cols-4 gap-4 select-none relative">
            <div id="speech-bubble"></div>
        </div>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4">
            <p id="modal-message" class="text-3xl font-bold mb-6"></p>
            <button id="modal-button" class="bg-yellow-400 hover:bg-yellow-500 text-white font-bold py-3 px-8 rounded-full text-xl shadow-md transform hover:scale-105 transition-transform duration-300">
                OK
            </button>
        </div>
    </div>

    <script>
        // --- DOMè¦ç´ ã®å–å¾— ---
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const startButton = document.getElementById('start-button');
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score');
        const timerDisplay = document.getElementById('timer');
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modal-message');
        const modalButton = document.getElementById('modal-button');
        const muteButton = document.getElementById('mute-button');
        const speechBubble = document.getElementById('speech-bubble');

        // --- ã‚²ãƒ¼ãƒ ã®çŠ¶æ…‹ç®¡ç† ---
        let score = 0;
        let timer = 30;
        let timerInterval;
        let isGameActive = false;
        let isMuted = false;
        const holes = [];

        // --- ã‚»ãƒªãƒ•ãƒªã‚¹ãƒˆ ---
        const babyQuotes = [
            "ãƒ³ã‚´ãƒ³ã‚´www", "ãƒ•ã‚¡ãƒƒï¼ï¼Ÿ", "ã‚¤ãƒƒãƒã€è¦‹ã¤ã‹ã£ãŸãƒ³ã‚´", "ãƒ¯ã‚¤ã€æœ‰èƒ½", "ã“ã‚Œã¯åé‡‡é…",
            "ã‚µãƒ³ã‚¤ãƒ", "ã¡ãªDe", "è‰ç”Ÿãˆã‚‹", "ã‚‚ã†çµ‚ã‚ã‚Šã ã‚ˆã“ã®ç•‘", "ã™ã¾ã‚“ãª", "ãˆãˆã‚“ã‹ï¼Ÿ",
            "ãªã‚“ã§ã‚„ï¼", "ã‚„ã£ãŸãœã€‚", "å¤§æ­£ç¾©ã‚­ãƒ£ãƒ™ãƒ„è»", "ã¯ã„ã€è«–ç ´", "ãƒï¼Ÿ", "æ¶™ãŒã§ã€å‡ºã¾ã™ã‚ˆâ€¦",
            "ã“ã‚Œã‚‚ã†ã‚ã‹ã‚“ã­ã‡ãª", "ã†ãƒ¼ã‚“ã€ã“ã®", "ãŠã€ãã†ã ãª", "ã¯ãˆã€œã™ã£ã”ã„", "ã‚¬ãƒƒãƒ„ãƒªã§è‰",
            "å½“ç„¶ã®çµæœã§ã™ã‚", "ãƒŸãƒ«ã‚¯ã®æ™‚é–“ã ã‚ã‚ã‚", "ãƒã‚¸ãƒãƒ¡ãã‚“ã€è¦‹ã¦ã‚‹ã€œï¼Ÿ", "çµ¶è¨±",
            "ã»ãªã‚‰ã­ç†è«–", "ãã†ã®éŸ³ã‚‚å‡ºãªã„", "ç•°è«–ã¯èªã‚ã‚‹", "ãªãŠã€æ˜æ—¥ã¯", "çŒ›è™é­‚ã‚’æ„Ÿã˜ã‚‹",
            "çŸ¥ã‚‰ã‚“ã‘ã©", "ã‚¢ã‚«ãƒ³", "è‰ä¸å¯é¿", "ã›ã‚„ãª", "ã¡ãªé·¹", "ã¡ãªå·¨", "ã¡ãªè™"
        ];
        const feministQuotes = [
            "ãã‚Œã€å¥³ã®ç§ã¸ã®æŠ‘åœ§ã§ã™ã‚ˆã­ï¼Ÿ", "ç”·ã•ã‚“â€¦w", "ã¯ã„ã€#metoo", "ãã®ç™ºè¨€ã€ãƒŸã‚½ã‚¸ãƒ‹ãƒ¼ã§ã™ã‚ˆ",
            "ã‚ã‹ã‚‹ï½", "ã‚ªã‚¿ã‚¯ãã‚“ã•ãâ€¦", "ãã†ã„ã†ã¨ã“ã‚„ã", "ã¯ã„ã€é€šå ±", "å¥³æ€§å·®åˆ¥",
            "#stopAsianHate", "å¤šæ§˜æ€§ã®æ™‚ä»£ãªã‚“ã§", "ãã‚Œã£ã¦ã‚ãªãŸã®æ„Ÿæƒ³ã§ã™ã‚ˆã­ï¼Ÿ", "ã¯ã„ãƒ–ãƒ­ãƒƒã‚¯",
            "ã‚¯ã‚½ãƒªãƒ—ä¹™", "ãƒãƒ³ã‚¹ãƒ—ãƒ¬ã‚¤ãƒ‹ãƒ³ã‚°ã‚„ã‚ã¦", "ãƒ«ãƒƒã‚­ã‚ºãƒ ã§ã¯ï¼Ÿ", "ç”·ã¯å˜ç´”ã§ã„ã„ã‚ˆã­",
            "ã‚½ãƒ¼ã‚¹ã¯ï¼Ÿ", "å‹‰å¼·ä¸è¶³ã§ã™ã­", "ãã‚Œãª", "ã‚ã‚Šãˆãªã„", "ã¯ï¼Ÿ", "ç„¡ç†", "ã‚­ãƒ¢"
        ];

        // --- ã‚µã‚¦ãƒ³ãƒ‰é–¢é€£ã®åˆæœŸè¨­å®š ---
        const synth = new Tone.Synth().toDestination();
        const musicLoop = new Tone.Sequence((time, note) => {
            synth.triggerAttackRelease(note, "8n", time);
        }, ["C4", "E4", "G4", "E4"], "4n");
        Tone.Transport.bpm.value = 140;

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        startButton.addEventListener('click', async () => {
            await Tone.start();
            startGame();
        });
        modalButton.addEventListener('click', handleModalClick);
        muteButton.addEventListener('click', toggleMute);

        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            isGameActive = true;
            score = 0;
            timer = 30;
            scoreDisplay.textContent = score;
            timerDisplay.textContent = timer;
            
            createBoard(12);
            startTimer();
            
            if (Tone.Transport.state !== 'started') Tone.Transport.start();
            musicLoop.start();
            
            // â˜…å¤‰æ›´: ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹
            gameLoop();
        }

        // â˜…è¿½åŠ : ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦é›£æ˜“åº¦ãŒå¤‰ã‚ã‚‹ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        function gameLoop() {
            if (!isGameActive) return; // ã‚²ãƒ¼ãƒ ãŒçµ‚äº†ã—ã¦ã„ãŸã‚‰ãƒ«ãƒ¼ãƒ—ã‚’æ­¢ã‚ã‚‹

            popRandomCharacter();

            // ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦æ¬¡ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒå‡ºç¾ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’è¨ˆç®—
            // ã‚¹ã‚³ã‚¢ãŒä¸ŠãŒã‚‹ã»ã©ã€é–“éš”ãŒçŸ­ããªã‚‹ï¼ˆé€Ÿããªã‚‹ï¼‰
            const interval = Math.max(250, 900 - score * 10); // æœ€ä½é€Ÿåº¦250ms

            setTimeout(gameLoop, interval);
        }

        function createBoard(numHoles) {
            gameBoard.innerHTML = '';
            gameBoard.appendChild(speechBubble);
            holes.length = 0;

            for (let i = 0; i < numHoles; i++) {
                const hole = document.createElement('div');
                hole.classList.add('hole');
                hole.style.aspectRatio = '1 / 1';
                hole.dataset.active = 'false';

                const character = document.createElement('div');
                character.classList.add('character');
                
                hole.appendChild(character);
                hole.addEventListener('click', handleWhack);
                gameBoard.appendChild(hole);
                holes.push(hole);
            }
        }

        function popRandomCharacter() {
            if (!isGameActive) return;
            
            const availableHoles = holes.filter(h => h.dataset.active === 'false');
            if (availableHoles.length === 0) return;

            const hole = availableHoles[Math.floor(Math.random() * availableHoles.length)];
            const characterEl = hole.querySelector('.character');

            const characterType = Math.random() < 0.75 ? 'baby' : 'feminist';
            hole.dataset.characterType = characterType;
            characterEl.textContent = characterType === 'baby' ? 'ğŸ‘¶' : 'ğŸ‘©â€ğŸ«';

            hole.dataset.active = 'true';
            hole.classList.add('up');
            
            // â˜…å¤‰æ›´: ã‚¹ã‚³ã‚¢ãŒä¸ŠãŒã‚‹ã»ã©è¡¨ç¤ºæ™‚é–“ãŒçŸ­ããªã‚‹
            const popDuration = Math.max(400, 1200 - score * 8);
            setTimeout(() => {
                if (hole.dataset.active === 'true') {
                    hole.classList.remove('up');
                    hole.dataset.active = 'false';
                }
            }, popDuration);
        }

        function handleWhack(event) {
            if (!isGameActive) return;
            const hole = event.currentTarget;

            if (hole.dataset.active === 'true') {
                const characterType = hole.dataset.characterType;
                
                if (characterType === 'baby') {
                    score++;
                    synth.triggerAttackRelease("G4", "16n");
                } else {
                    score = Math.max(0, score - 2);
                    synth.triggerAttackRelease("C3", "16n");
                }
                
                scoreDisplay.textContent = score;
                hole.dataset.active = 'false';
                hole.classList.remove('up');
                hole.querySelector('.character').classList.add('whacked');
                
                showCharacterQuote(hole, characterType);

                setTimeout(() => {
                    hole.querySelector('.character').classList.remove('whacked');
                }, 300);
            }
        }
        
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timer--;
                timerDisplay.textContent = timer;
                if (timer <= 0) gameOver();
            }, 1000);
        }
        
        function speak(text, characterType) {
            if (isMuted) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            if (characterType === 'baby') {
                utterance.rate = 1.2;
                utterance.pitch = 1.5;
            } else {
                utterance.rate = 1.0;
                utterance.pitch = 0.8;
            }
            window.speechSynthesis.speak(utterance);
        }

        function showCharacterQuote(hole, characterType) {
            const quotes = characterType === 'baby' ? babyQuotes : feministQuotes;
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            
            speechBubble.textContent = randomQuote;
            speak(randomQuote, characterType);
            
            speechBubble.style.left = `${hole.offsetLeft + hole.offsetWidth / 2}px`;
            speechBubble.style.top = `${hole.offsetTop}px`;
            speechBubble.classList.add('show');
            setTimeout(() => speechBubble.classList.remove('show'), 1200);
        }

        function toggleMute() {
            isMuted = !isMuted;
            Tone.Destination.mute = isMuted;
            if (isMuted) window.speechSynthesis.cancel();
            muteButton.textContent = isMuted ? 'SOUNDğŸ”‡' : 'SOUNDğŸ”Š';
            muteButton.classList.toggle('bg-pink-400', !isMuted);
            muteButton.classList.toggle('hover:bg-pink-500', !isMuted);
            muteButton.classList.toggle('bg-gray-400', isMuted);
            muteButton.classList.toggle('hover:bg-gray-500', isMuted);
        }

        function gameOver() {
            isGameActive = false;
            // â˜…å¤‰æ›´: clearIntervalã¯ä¸è¦ã«
            clearInterval(timerInterval);
            musicLoop.stop();
            synth.triggerAttackRelease("G2", "4n");
            showMessage(`çµ‚äº†ï¼<br>ã‚¹ã‚³ã‚¢: ${score}`, 'ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦');
        }

        function showMessage(message, buttonText) {
            modalMessage.innerHTML = message;
            modalButton.textContent = buttonText;
            modal.classList.remove('hidden');
        }

        function handleModalClick() {
            modal.classList.add('hidden');
            if (modalButton.textContent === 'ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦') {
                startGame();
            } else {
                gameScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            }
        }
    </script>

</body>
</html>

